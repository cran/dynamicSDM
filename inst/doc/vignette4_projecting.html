<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>dynamicSDM: Dynamic distribution projections</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">dynamicSDM: Dynamic distribution
projections</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dynamicSDM)</span></code></pre></div>
<div id="stage-4-dynamic-projections-of-species-distribution" class="section level2">
<h2>Stage 4: Dynamic projections of species distribution</h2>
<p>In this tutorial, we will learn about functions within the
<em>dynamicSDM</em> package for projecting intra- and inter-annual
geographical distributions and abundances at high spatiotemporal
resolution. This will involve extracting rasters for each explanatory
variable across southern Africa at various intervals. Then we can
project our dynamic SDMs onto these data to visualise species
distribution patterns through space and time.</p>
<p>The <em>dynamicSDM</em> functions for extracting dynamic rasters
require Google Earth Engine and Google Drive to be initialised. Fill in
the code below with your Google account email, and run the code to check
that <em>rgee</em> and <em>googledrive</em> have been correctly
installed and authorised.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rgee<span class="sc">::</span><span class="fu">ee_check</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googledrive)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>googledrive<span class="sc">::</span><span class="fu">drive_user</span>()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#user.email&lt;-&quot;your_google_email_here&quot;</span></span></code></pre></div>
<p>Note: You will need internet connection for this tutorial. Raster
extraction may take some time depending on your internet connection
strength.</p>
</div>
<div id="directory-organisation" class="section level2">
<h2>Directory organisation</h2>
<p>We will be extracting rasters, generating projection covariate data
frames, exporting projection rasters and saving GIFs. Let’s first make
separate folders in our project directory to save this various outputs
too. This is especially important as this suite of <em>dynamicSDM</em>
functions rely on unique naming of files in the local directory or drive
folder.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>variablenames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;eight_sum_prec&quot;</span>, <span class="st">&quot;year_sum_prec&quot;</span>, <span class="st">&quot;grass_crop_percentage&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>project_directory <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;dynamicSDM_vignette&quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># project_directory&lt;-&quot;your_path_here&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(project_directory, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>projection_directories <span class="ot">&lt;-</span> <span class="fu">file.path</span>(project_directory, <span class="st">&quot;projection&quot;</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(projection_directories, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>projectionrasters <span class="ot">&lt;-</span> <span class="fu">file.path</span>(project_directory, <span class="st">&quot;projectionrasters&quot;</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(projectionrasters, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>projection_covariates <span class="ot">&lt;-</span> <span class="fu">file.path</span>(project_directory, <span class="st">&quot;projectioncovariates&quot;</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(projection_covariates, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>projection_GIF <span class="ot">&lt;-</span> <span class="fu">file.path</span>(project_directory, <span class="st">&quot;projection_GIF&quot;</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(projection_GIF, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="a-generate-projection-dates" class="section level3">
<h3>a) Generate projection dates</h3>
<p><code>dynamic_proj_dates()</code> generates all dates in a given
period at the interval type and size specified. This can be used to
create a vector of dates that you want to project a species distribution
at.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 day intervals</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dynamic_proj_dates</span>(<span class="at">startdate =</span> <span class="st">&quot;2018-01-01&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">enddate =</span> <span class="st">&quot;2018-12-01&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval =</span> <span class="dv">5</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval.level =</span> <span class="st">&quot;day&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;2018-01-01&quot; &quot;2018-01-06&quot; &quot;2018-01-11&quot; &quot;2018-01-16&quot; &quot;2018-01-21&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;2018-01-26&quot; &quot;2018-01-31&quot; &quot;2018-02-05&quot; &quot;2018-02-10&quot; &quot;2018-02-15&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;2018-02-20&quot; &quot;2018-02-25&quot; &quot;2018-03-02&quot; &quot;2018-03-07&quot; &quot;2018-03-12&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] &quot;2018-03-17&quot; &quot;2018-03-22&quot; &quot;2018-03-27&quot; &quot;2018-04-01&quot; &quot;2018-04-06&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;2018-04-11&quot; &quot;2018-04-16&quot; &quot;2018-04-21&quot; &quot;2018-04-26&quot; &quot;2018-05-01&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] &quot;2018-05-06&quot; &quot;2018-05-11&quot; &quot;2018-05-16&quot; &quot;2018-05-21&quot; &quot;2018-05-26&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] &quot;2018-05-31&quot; &quot;2018-06-05&quot; &quot;2018-06-10&quot; &quot;2018-06-15&quot; &quot;2018-06-20&quot;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [36] &quot;2018-06-25&quot; &quot;2018-06-30&quot; &quot;2018-07-05&quot; &quot;2018-07-10&quot; &quot;2018-07-15&quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] &quot;2018-07-20&quot; &quot;2018-07-25&quot; &quot;2018-07-30&quot; &quot;2018-08-04&quot; &quot;2018-08-09&quot;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [46] &quot;2018-08-14&quot; &quot;2018-08-19&quot; &quot;2018-08-24&quot; &quot;2018-08-29&quot; &quot;2018-09-03&quot;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [51] &quot;2018-09-08&quot; &quot;2018-09-13&quot; &quot;2018-09-18&quot; &quot;2018-09-23&quot; &quot;2018-09-28&quot;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [56] &quot;2018-10-03&quot; &quot;2018-10-08&quot; &quot;2018-10-13&quot; &quot;2018-10-18&quot; &quot;2018-10-23&quot;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [61] &quot;2018-10-28&quot; &quot;2018-11-02&quot; &quot;2018-11-07&quot; &quot;2018-11-12&quot; &quot;2018-11-17&quot;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [66] &quot;2018-11-22&quot; &quot;2018-11-27&quot;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 week intervals</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">dynamic_proj_dates</span>(<span class="at">startdate =</span> <span class="st">&quot;2018-01-01&quot;</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">enddate =</span> <span class="st">&quot;2018-12-01&quot;</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval =</span> <span class="dv">2</span>, </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">interval.level =</span> <span class="st">&quot;week&quot;</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;2018-01-01&quot; &quot;2018-01-15&quot; &quot;2018-01-29&quot; &quot;2018-02-12&quot; &quot;2018-02-26&quot;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;2018-03-12&quot; &quot;2018-03-26&quot; &quot;2018-04-09&quot; &quot;2018-04-23&quot; &quot;2018-05-07&quot;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] &quot;2018-05-21&quot; &quot;2018-06-04&quot; &quot;2018-06-18&quot; &quot;2018-07-02&quot; &quot;2018-07-16&quot;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] &quot;2018-07-30&quot; &quot;2018-08-13&quot; &quot;2018-08-27&quot; &quot;2018-09-10&quot; &quot;2018-09-24&quot;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] &quot;2018-10-08&quot; &quot;2018-10-22&quot; &quot;2018-11-05&quot; &quot;2018-11-19&quot;</span></span></code></pre></div>
<p>For this tutorial, we will use the following projection dates to
explore the intra-annual distribution patterns of red-billed quelea in
southern Africa.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>projectiondates <span class="ot">&lt;-</span> <span class="fu">dynamic_proj_dates</span>(<span class="at">startdate =</span> <span class="st">&quot;2018-01-01&quot;</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">enddate =</span> <span class="st">&quot;2018-12-01&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">interval =</span> <span class="dv">3</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">interval.level =</span> <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
</div>
<div id="b-extract-projection-rasters" class="section level3">
<h3>b) Extract projection rasters</h3>
<p><code>extract_dynamic_raster()</code> and
<code>extract_buffered_raster()</code> are sister functions to those
used in stage 2 to extract explanatory variables. They require largely
the same arguments input, but with arguments to specify the temporal
(projection dates) and spatial extents for the rasters.</p>
<p>Run the following code to extract rasters for each explanatory
variable and projection date.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;sample_extent_data&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_dynamic_raster</span>(<span class="at">dates =</span> projectiondates,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasetname =</span> <span class="st">&quot;UCSB-CHG/CHIRPS/DAILY&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bandname =</span> <span class="st">&quot;precipitation&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">user.email =</span> user.email,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">spatial.res.metres =</span> <span class="dv">5566</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">GEE.math.fun =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">temporal.direction =</span> <span class="st">&quot;prior&quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">temporal.res =</span> <span class="dv">56</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">spatial.ext =</span> sample_extent_data,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">varname =</span> variablenames[<span class="dv">1</span>],</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">save.directory =</span> projectionrasters)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_dynamic_raster</span>(<span class="at">dates =</span> projectiondates,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">datasetname =</span> <span class="st">&quot;UCSB-CHG/CHIRPS/DAILY&quot;</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">bandname =</span> <span class="st">&quot;precipitation&quot;</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">user.email =</span> user.email,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">spatial.res.metres =</span> <span class="dv">5566</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">GEE.math.fun =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">temporal.direction =</span> <span class="st">&quot;prior&quot;</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">temporal.res =</span> <span class="dv">364</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">spatial.ext =</span> sample_extent_data,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">varname =</span> variablenames[<span class="dv">2</span>],</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">save.directory =</span> projectionrasters)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>matrix<span class="ot">&lt;-</span>dynamicSDM<span class="sc">::</span><span class="fu">get_moving_window</span>(<span class="at">radial.distance =</span> <span class="dv">10000</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">spatial.res.degrees =</span> <span class="fl">0.05</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">spatial.ext =</span> sample_extent_data)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_buffered_raster</span>(<span class="at">dates=</span>projectiondates,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">datasetname =</span> <span class="st">&quot;MODIS/006/MCD12Q1&quot;</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">bandname =</span> <span class="st">&quot;LC_Type5&quot;</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                        <span class="at">spatial.res.metres =</span> <span class="dv">500</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                        <span class="at">GEE.math.fun =</span> <span class="st">&quot;sum&quot;</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                        <span class="at">moving.window.matrix =</span> matrix,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">user.email =</span> user.email,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                        <span class="at">categories =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                        <span class="at">agg.factor =</span> <span class="dv">12</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                        <span class="at">spatial.ext =</span> sample_extent_data,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                        <span class="at">varname =</span> variablenames[<span class="dv">3</span>],</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                        <span class="at">save.directory =</span> projectionrasters)</span></code></pre></div>
</div>
<div id="c-combine-dynamic-projection-covariates" class="section level3">
<h3>c) Combine dynamic projection covariates</h3>
<p>Now we need to combine the rasters for each variable into single
projection covariate data frames for each projection date.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dynamic_proj_covariates</span>(<span class="at">dates =</span> projectiondates,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">varnames =</span> variablenames,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">local.directory =</span> projectionrasters,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">spatial.ext =</span> sample_extent_data,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">spatial.mask =</span> sample_extent_data,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">spatial.res.degrees =</span> <span class="fl">0.05</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">resample.method =</span> <span class="fu">c</span>(<span class="st">&quot;bilinear&quot;</span>,<span class="st">&quot;bilinear&quot;</span>,<span class="st">&quot;ngb&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cov.file.type =</span> <span class="st">&quot;csv&quot;</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prj=</span><span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">save.directory =</span> projection_covariates)</span></code></pre></div>
</div>
<div id="d-project-models-onto-covariates" class="section level3">
<h3>d) Project models onto covariates</h3>
<p>To project distribution onto these covariates, our fitted boosted
regression tree models from stage 3 need to be imported and input into
<code>dynamic_proj()</code>. You can read these in from your local
directory, or simply rerun the code here.</p>
<p>We choose to project distribution suitability
(<code>projection.method = proportional</code>) but this function can
also generate binary projections if given threshold
(<code>sdm.thresh</code>) or abundance if given fitted species abundance
models (<code>sam.mod</code>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sample_brt_models&lt;- readRDS(paste0(project_directory, &quot;/fitted_quelea_SDMs.rds&quot;))</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;sample_explan_data&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>sample_explan_data<span class="sc">$</span>weights <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> sample_explan_data<span class="sc">$</span>REL_SAMP_EFFORT)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sample_brt_models <span class="ot">&lt;-</span> <span class="fu">brt_fit</span>(sample_explan_data,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">response.col =</span> <span class="st">&quot;presence.absence&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">varnames =</span> variablenames,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">block.col =</span> <span class="st">&quot;BLOCK.CATS&quot;</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">weights.col =</span> <span class="st">&quot;weights&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">distribution =</span> <span class="st">&quot;bernoulli&quot;</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dynamic_proj</span>(<span class="at">dates =</span> projectiondates,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">projection.method =</span> <span class="fu">c</span>(<span class="st">&quot;proportional&quot;</span>),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">local.directory =</span> projection_covariates,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">cov.file.type =</span> <span class="st">&quot;csv&quot;</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">sdm.mod =</span> sample_brt_models,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">spatial.mask =</span> sample_extent_data,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">save.directory =</span> projection_directories)</span></code></pre></div>
<p>Let’s read in and plot our projections!</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list.files</span>(projection_directories)[<span class="dv">1</span>]))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list.files</span>(projection_directories)[<span class="dv">2</span>]))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list.files</span>(projection_directories)[<span class="dv">3</span>]))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list.files</span>(projection_directories)[<span class="dv">4</span>]))</span></code></pre></div>
</div>
<div id="e-visualise-projections-with-a-gif" class="section level3">
<h3>e) Visualise projections with a GIF</h3>
<p>To better visualise our dynamic distribution projections through
time, <code>dynamic_proj_GIF()</code> can generate animated GIFs from
the projection rasters.</p>
<p>We will set our own colour scheme and add borders for the southern
African countries.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cols1<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#F0F0F0&quot;</span>,<span class="st">&quot;#40863A&quot;</span>,<span class="st">&quot;#FBF357&quot;</span>,<span class="st">&quot;#ED8E07&quot;</span>,<span class="st">&quot;#cc0000&quot;</span>,<span class="st">&quot;#660000&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>border.countries<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;South Africa&#39;</span>, <span class="st">&#39;Botswana&#39;</span>,<span class="st">&#39;Lesotho&#39;</span>, <span class="st">&#39;Swaziland&#39;</span>,<span class="st">&#39;Mozambique&#39;</span>,<span class="st">&#39;Namibia&#39;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                     ,<span class="st">&#39;Zimbabwe&#39;</span>,<span class="st">&#39;Angola&#39;</span>,<span class="st">&#39;Zambia&#39;</span>,<span class="st">&#39;Malawi&#39;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dynamic_proj_GIF</span>(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dates =</span> projectiondates,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">projection.type =</span> <span class="st">&quot;proportional&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">local.directory =</span> projection_directories,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">save.directory =</span> projection_GIF,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour.palette.custom =</span> cols1,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">borders =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">border.regions =</span> border.countries,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">border.colour =</span> <span class="st">&quot;grey50&quot;</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.max =</span> <span class="dv">1</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.min =</span> <span class="dv">0</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.name =</span>  <span class="st">&quot;Distribution</span><span class="sc">\n</span><span class="st"> suitability&quot;</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">file.name =</span> <span class="st">&quot;RBQ_proportional_GIF&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<ul>
<li><p>This concludes the <em>dynamicSDM</em> tutorial. We hope that you
have been able to utilise the package to model the dynamic distributions
of our case study species, the red-billed quelea, and can now apply
these functions to your own study species!</p></li>
<li><p>We have demonstrated a variety of options across our functions,
but even more are available with the diverse and flexible arguments.
Please see our package manual for full details of each
<em>dynamicSDM</em> function <a href="https://github.com/r-a-dobson/dynamicSDM/blob/main/man/figures/dynamicSDM_1.3.pdf">manual</a>.</p></li>
<li><p>Also, please visit the GitHub discussion page for
<em>dynamicSDM</em> if you have any questions or are facing errors with
any of our functions <a href="https://github.com/r-a-dobson/dynamicSDM/issues">github</a>. We
also have a quick guide to common bugs that are thrown up when
installing and running <em>dynamicSDM</em>.</p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
